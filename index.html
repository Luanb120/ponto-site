<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ponto Online</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 24px; max-width: 900px; margin: auto; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 20px; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; }
    input, button { padding: 10px 12px; font-size: 16px; }
    button { cursor: pointer; }
    table { border-collapse: collapse; width: 100%; margin-top: 18px; }
    th, td { border: 1px solid #ccc; padding: 8px 10px; text-align: left; }
    .msg { margin-top: 12px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Ponto Online</h1>
  <div class="card">
    <form id="loginForm">
      <div class="row">
        <input id="matricula" name="matricula" type="text" placeholder="Matrícula" required />
        <input id="senha" name="senha" type="password" placeholder="Senha" required />
        <button id="btnEntrar" type="submit">Entrar</button>
      </div>
      <div id="status" class="msg"></div>
    </form>

    <div id="conteudo" class="hidden">
      <p id="saudacao"></p>
      <div id="tabelaWrap"></div>
      <button id="sair">Sair</button>
    </div>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxZ979F-vWQwSi7HesyfzvL0pGeAHdEsxjuzVzpIphP6j4Ix9E0aKcm2w6u34OseFjI/exec"; // <-- cole aqui a URL /exec do seu Apps Script
    const form = document.getElementById('loginForm');
    const statusEl = document.getElementById('status');
    const conteudo = document.getElementById('conteudo');
    const tabelaWrap = document.getElementById('tabelaWrap');
    const saudacao = document.getElementById('saudacao');
    const btnSair = document.getElementById('sair');

    // (Opcional) manter matrícula na sessão
    const savedMat = localStorage.getItem('matricula');
    if (savedMat) document.getElementById('matricula').value = savedMat;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = "Carregando...";
      tabelaWrap.innerHTML = "";
      const matricula = (document.getElementById('matricula').value || "").trim();
      const senha = (document.getElementById('senha').value || "").trim();

      if (!matricula || !senha) {
        statusEl.textContent = "Informe matrícula e senha.";
        return;
      }

      try {
        const body = new URLSearchParams({ matricula, senha });
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
          body
        });

        const text = await res.text();
        let data;
        try { data = JSON.parse(text); } catch (err) {
          throw new Error("Resposta da API inválida.");
        }

        if (data && data.error) {
          statusEl.textContent = data.error;
          return;
        }

        // sucesso
        statusEl.textContent = "";
        conteudo.classList.remove('hidden');
        saudacao.textContent = `Bem-vindo! Matrícula: ${matricula}`;
        localStorage.setItem('matricula', matricula);

        if (!Array.isArray(data) || data.length === 0) {
          tabelaWrap.innerHTML = "<p>Não há batidas para este usuário.</p>";
          return;
        }

        // montar tabela
        let html = "<table><thead><tr><th>Data</th><th>Hora</th><th>Tipo</th></tr></thead><tbody>";
        for (const row of data) {
          html += `<tr><td>${row.data ?? ""}</td><td>${row.hora ?? ""}</td><td>${row.tipo ?? ""}</td></tr>`;
        }
        html += "</tbody></table>";
        tabelaWrap.innerHTML = html;
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Erro ao comunicar com a API. Verifique a URL do Apps Script e o deploy.";
      }
    });

    btnSair.addEventListener('click', () => {
      conteudo.classList.add('hidden');
      tabelaWrap.innerHTML = "";
      saudacao.textContent = "";
      statusEl.textContent = "Você saiu.";
    });
  </script>
</body>
</html>
